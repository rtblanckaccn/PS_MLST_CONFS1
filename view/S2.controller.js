/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");jQuery.sap.require("sap.m.MessageToast");jQuery.sap.require("sap.m.MessageBox");sap.ca.scfld.md.controller.ScfldMasterController.extend("i2d.ps.milestone.confirm.s1.view.S2",{onInit:function(){var a=sap.ca.scfld.md.app.Application.getImpl();this.oApplicationImplementation=a;this.crossNavigation=false;this.AnaNav=false;this.Ref=0;var i=a.AppI18nModel;this.flag=0;this.sFilterPattern="";window.mlstblank=undefined;var c=a.getComponent();var C=c.getComponentData();var v=this.getView();v=this.getView();var l=this.getList();l.setShowNoData(false);this.page=v.byId("page");window.index=0;var u=sap.ushell.Container.getService("URLParsing");var U=u.getHash("#"+window.location.href);this.initialLoad=0;this.groupingFlag=false;this.fixCountIssue();var m=null;var f=null;var b=null;var L=null;var o=null;if(U.search("discuss")!=-1&&U.search("MilestoneDetailSet")!=-1){var s=U.split("?");var M=s[1].split("(");var d=M[1].split(")");this.flag=1;this.crossNavigation=true;this.oApplicationImplementation.crossNavigation=true;this.oMilestone=d[0].match(/'([^']+)'/)[1];m=this.getView().byId("MAIN_LIST_ITEM");this.crossNavigation=true;f=new sap.ui.model.Filter("ProjectMilestone",'EQ',this.oMilestone);b={};b.path="/MilestoneDetailSet";b.filters=f;b.template=m;L=v.byId("list");L.setShowNoData(true);o=L.getItems()[0];if(typeof o!="undefined"){if(L.isPhone==false){L.fireSelect({listItem:o});}}L.isPhone=this.getView().getModel("device").oData.isPhone;L.bindAggregation("items",b);L.setNoDataText(i.getResourceBundle().getText('LOADING'));this.getView().byId("MAIN_LIST_ITEM").bindProperty("title","MilestoneDescription",function(e){return e;});this.getView().byId("ATTR1").bindProperty("text","ProjectMilestone",function(e){if(e=="")return e;else return e.replace(/^0+/,'');});this.getView().byId("MAIN_LIST_ITEM").bindProperty("number","MilestoneDays",function(e){if(e==""){return e;}else{if(e<0)return-(e);else return e;}});this.getView().byId("milestoneType").bindProperty("text","MilestoneDays",function(e){if(e==0)return"";else{if(e<0)return i.getResourceBundle().getText("OVERDUE_NEW");else return i.getResourceBundle().getText("DUE_NEW");}});this.getView().byId("milestoneType").bindProperty("state","MilestoneDays",function(e){if(e==""){return"Warning";}else{if(e==0)return"Warning";else{if(e<0)return"Warning";}}});this.getView().byId("MAIN_LIST_ITEM").bindProperty("numberUnit","MilestoneDays",function(e){if(e==null)return"";else{if(e==1||e==-1)return i.getResourceBundle().getText("DAY_NEW");else return i.getResourceBundle().getText("DAYS_NEW");}});}else{if(typeof C.startupParameters!="undefined"){if(typeof C.startupParameters.key!="undefined"||typeof C.startupParameters.ProjectMilestone!="undefined"){this.flag=1;this.crossNavigation=true;this.AnaNav=true;this.oApplicationImplementation.crossNavigation=true;if(C.startupParameters.key!=undefined){this.oMilestone=C.startupParameters.key[0];this.kpiid=C.startupParameters.KPICODE[0];this.variantid=C.startupParameters.VARIANTID[0];this.tiletype=C.startupParameters.TILETYPE[0];}else{this.oMilestone=C.startupParameters.ProjectMilestone[0];}m=this.getView().byId("MAIN_LIST_ITEM");this.crossNavigation=true;f=new sap.ui.model.Filter("ProjectMilestone",'EQ',this.oMilestone);b={};b.path="/MilestoneDetailSet";b.filters=f;b.template=m;L=v.byId("list");L.setShowNoData(true);o=L.getItems()[0];if(typeof o!="undefined"){if(L.isPhone==false){L.fireSelect({listItem:o});}}L.isPhone=this.getView().getModel("device").oData.isPhone;L.bindAggregation("items",b);L.setNoDataText(i.getResourceBundle().getText('LOADING'));this.getView().byId("MAIN_LIST_ITEM").bindProperty("title","MilestoneDescription",function(e){return e;});this.getView().byId("ATTR1").bindProperty("text","ProjectMilestone",function(e){if(e=="")return e;else return e.replace(/^0+/,'');});this.getView().byId("MAIN_LIST_ITEM").bindProperty("number","MilestoneDays",function(e){if(e==""){return e;}else{if(e<0)return-(e);else return e;}});this.getView().byId("milestoneType").bindProperty("text","MilestoneDays",function(e){if(e==0)return"";else{if(e<0)return i.getResourceBundle().getText("OVERDUE_NEW");else return i.getResourceBundle().getText("DUE_NEW");}});this.getView().byId("milestoneType").bindProperty("state","MilestoneDays",function(e){if(e==""){return"Warning";}else{if(e==0)return"Warning";else{if(e<0)return"Warning";}}});this.getView().byId("MAIN_LIST_ITEM").bindProperty("numberUnit","MilestoneDays",function(e){if(e==null)return"";else{if(e==1||e==0||e==-1)return i.getResourceBundle().getText("DAY_NEW");else return i.getResourceBundle().getText("DAYS_NEW");}});}else{var t=this;sap.ca.scfld.md.controller.ScfldMasterController.prototype.onInit.call(this);jQuery.sap.require('sap.ushell.services.AppConfiguration');this.AnaNav=true;sap.ushell.services.AppConfiguration.getSettingsControl=function(){return new sap.ushell.ui.footerbar.SettingsButton();};L=v.byId("list");L.setShowNoData(true);L.setNoDataText(i.getResourceBundle().getText('LOADING'));this.getView().byId("MAIN_LIST_ITEM").bindProperty("title","MilestoneDescription",function(e){return e;});this.getView().byId("ATTR1").bindProperty("text","ProjectMilestone",function(e){if(e=="")return e;else return e.replace(/^0+/,'');});this.getView().byId("MAIN_LIST_ITEM").bindProperty("number","MilestoneDays",function(e){if(e==""){return e;}else{if(e<0)return-(e);else return e;}});this.getView().byId("milestoneType").bindProperty("text","MilestoneDays",function(e){if(e==0)return"";else{if(e<0)return i.getResourceBundle().getText("OVERDUE_NEW");else return i.getResourceBundle().getText("DUE_NEW");}});this.getView().byId("milestoneType").bindProperty("state","MilestoneDays",function(e){if(e==""){return"Warning";}else{if(e==0)return"Warning";else{if(e<0)return"Warning";}}});this.getView().byId("MAIN_LIST_ITEM").bindProperty("numberUnit","MilestoneDays",function(e){if(e==null)return"";else{if(e==1||e==-1)return i.getResourceBundle().getText("DAY_NEW");else return i.getResourceBundle().getText("DAYS_NEW");}});}}else{var t=this;sap.ca.scfld.md.controller.ScfldMasterController.prototype.onInit.call(this);jQuery.sap.require('sap.ushell.services.AppConfiguration');this.AnaNav=true;sap.ushell.services.AppConfiguration.getSettingsControl=function(){return new sap.ushell.ui.footerbar.SettingsButton();};L=v.byId("list");L.setShowNoData(true);L.setNoDataText(i.getResourceBundle().getText('LOADING'));this.getView().byId("MAIN_LIST_ITEM").bindProperty("title","MilestoneDescription",function(e){return e;});this.getView().byId("ATTR1").bindProperty("text","ProjectMilestone",function(e){if(e=="")return e;else return e.replace(/^0+/,'');});this.getView().byId("MAIN_LIST_ITEM").bindProperty("number","MilestoneDays",function(e){if(e==""){return e;}else{if(e<0)return-(e);else return e;}});this.getView().byId("milestoneType").bindProperty("text","MilestoneDays",function(e){if(e==0)return"";else{if(e<0)return i.getResourceBundle().getText("OVERDUE_NEW");else return i.getResourceBundle().getText("DUE_NEW");}});this.getView().byId("milestoneType").bindProperty("state","MilestoneDays",function(e){if(e==""){return"Warning";}else{if(e==0)return"Warning";else{if(e<0)return"Warning";}}});this.getView().byId("MAIN_LIST_ITEM").bindProperty("numberUnit","MilestoneDays",function(e){if(e==null)return"";else{if(e==1||e==-1)return i.getResourceBundle().getText("DAY_NEW");else return i.getResourceBundle().getText("DAYS_NEW");}});}}},fixCountIssue:function(){jQuery.sap.require('sap.ca.scfld.md.app.MasterHeaderFooterHelper');sap.ca.scfld.md.app.MasterHeaderFooterHelper.prototype.setHeaderFooter=function(c,o,a,k){if(!o){return;}if((c.crossNavigation!=undefined)&&(c.crossNavigation==true))a=true;var p=this.oCommonHeaderFooterHelper.startBuild(c,o,{bEditState:false,bIsSearching:false,bAllDisabled:a},k);this.defineHeader(c,p);this.defineFooter(c,p);this.oApplicationImplementation.oCurController.MasterCtrl=c;this.oApplicationImplementation.oCurController.FullCtrl=null;this.oCommonHeaderFooterHelper.endBuild(c);var l=c.getList();var i=l.getBinding("items");if(typeof i!="undefined"){var C=i.getLength();if((C==1)&&(typeof c.getList().getItems()[1]!="undefined")){var L=c.getList().getItems()[1];c.getList().fireSelect({listItem:L});}}};},applyBackendSearchPattern:function(f,b){var I=this._oApplicationImplementation.AppI18nModel;var l=this.getList();l.setNoDataText(I.getResourceBundle().getText('LOADING'));l.setShowNoData(true);var s=f;this.sFilterPattern=f;window.index=1;var a=sap.ca.scfld.md.app.Application.getImpl();var t=this;if(s&&s!="")var F=new sap.ui.model.Filter('WBSElement','EQ',s);else F=new sap.ui.model.Filter('','',s);var c=jQuery.proxy(function(){var l=this.byId('list');var p=this.byId('page');var d=a.oSplitContainer.getCurrentDetailPage();var e=d.getContent();var g=e[0].getContent();var h=l.getItems().length;if(h==0){l.setShowNoData(true);l.setNoDataText(I.getResourceBundle().getText('EMPTY_SEARCH_RESULT'));}else{l.setShowNoData(false);l.setNoDataText("");for(var i=0;i<g.length;i++){g[i].setVisible(true);}}b.detachFilter(c);},this);this.initialLoad=1;b.attachFilter(c,this);b.filter(F);},isBackendSearch:function(e){return true;},_handleSelect:function(e){var a=sap.ca.scfld.md.app.Application.getImpl();var i=a.AppI18nModel;var v=e.getSource().getParent().getParent().getParent().getParent();if(v.getParent().getAggregation("content")[0]._aDetailPages[0]!==undefined){if(v.getParent().getAggregation("content")[0]._aDetailPages[0].byId("actualDate")!=undefined)v.getParent().getAggregation("content")[0]._aDetailPages[0].byId("actualDate").setValue("");}this.setListItem(e.getParameter("listItem"));if(!sap.ui.Device.phone){a.oSplitContainer.hideMaster();}},onDataLoaded:function(){this.oApplicationImplementation=sap.ca.scfld.md.app.Application.getImpl();this.oI18nModel=this.oApplicationFacade.oApplicationImplementation.AppI18nModel;var l=this.getList();l.setShowNoData(true);l.setNoDataText(this.oI18nModel.getResourceBundle().getText('LOADING'));var c=l.getBinding("items").getLength();var u=sap.ushell.Container.getService("URLParsing");if(c===0){if(this.initialLoad==0){l.setNoDataText(this.oI18nModel.getResourceBundle().getText("EMPTY_SEARCH_RESULT"));if(!sap.ui.Device.phone){this.showEmptyView();}this.initialLoad=this.initialLoad+1;if(this.flag===1){var t=this;var d=new sap.m.Dialog({type:'Message',content:new sap.m.Text({text:t.oApplicationFacade.oApplicationImplementation.AppI18nModel.getResourceBundle().getText('WRONG_MLST')}),beginButton:new sap.m.Button({text:'OK',press:function(){window.history.go(-1);}}),afterClose:function(){d.destroy();}});this.flag=0;d.open();}}else{l.setNoDataText(this.oI18nModel.getResourceBundle().getText("EMPTY_SEARCH_RESULT"));if(!sap.ui.Device.phone){this.showEmptyView();}if(this.flag===1){var t=this;var d=new sap.m.Dialog({type:'Message',content:new sap.m.Text({text:t.oApplicationFacade.oApplicationImplementation.AppI18nModel.getResourceBundle().getText('WRONG_MLST')}),beginButton:new sap.m.Button({text:'OK',press:function(){window.history.go(-1);}}),afterClose:function(){d.destroy();}});this.flag=0;d.open();}}}else{if(window.index==1){this.selectFirstItem();}else{if(window.mlstblank!==undefined){var f=0;window.initialLoad=0;for(var i=0;i<c;i++){if(window.mlstblank===l.getBinding("items").aKeys[i].match(/'([^']+)'/)[1]){f=1;}}if(f===0&&u.getHash("#"+window.location.href).search("&/detail")!=-1){var p=u.getHash("#"+window.location.href).split("&/detail");this.selectFirstItem();}}}l.setNoDataText("");}},getHeaderFooterOptions:function(){var a=sap.ca.scfld.md.app.Application.getImpl();var l=this.getList();if(this.Ref===1){this.selectFirstItem();this.Ref=0;}var i=a.AppI18nModel;return{sI18NMasterTitle:i.getProperty("MASTER_TITLE_NEW"),oGroupOptions:{sId:"groupId",bDisabled:false,aGroupItems:[{text:i.getProperty("NO_GRP"),key:"no"},{text:i.getProperty("PROJ"),key:"proj"}],onGroupSelected:jQuery.proxy(function(e){this._openGroupByPopover(e);},this)}};},_handleGroupingChanged:function(e){var k=e;if(k=="no"){this.bindList2('Project');}if(k=="proj"){this.bindList('Project');}},_openGroupByPopover:function(e){this._handleGroupingChanged(e);},bindList2:function(p){var t=this;var v=this.getView();var T=this.getView().byId("MAIN_LIST_ITEM");var l=v.byId("list");var f=new sap.ui.model.Filter('WBSElement',sap.ui.model.FilterOperator.Contains,this.sFilterPattern);var a=sap.ca.scfld.md.app.Application.getImpl();var i=a.AppI18nModel;this.groupingFlag=false;l.setShowNoData(true);l.setNoDataText(i.getResourceBundle().getText('LOADING'));if(this.sFilterPattern!=""){l.bindAggregation("items",{path:"/MilestoneDetailSet",template:T,filters:f,groupHeaderFactory:function(g){return new sap.m.GroupHeaderListItem({title:g.text,upperCase:false});}});}else{l.bindAggregation("items",{path:"/MilestoneDetailSet",template:T,groupHeaderFactory:function(g){return new sap.m.GroupHeaderListItem({title:g.text,upperCase:false});}});}this.registerMasterListBind(l);},bindList:function(p){var t=this;var v=this.getView();var f=new sap.ui.model.Filter('WBSElement',sap.ui.model.FilterOperator.Contains,this.sFilterPattern);var T=this.getView().byId("MAIN_LIST_ITEM");var a=sap.ca.scfld.md.app.Application.getImpl();var i=a.AppI18nModel;this.groupingFlag=true;var l=v.byId("list");l.setShowNoData(true);l.setNoDataText(i.getResourceBundle().getText('LOADING'));var s=new sap.ui.model.Sorter({path:p,descending:false,group:t.groupByProject});if(this.sFilterPattern!=""){l.bindAggregation("items",{path:"/MilestoneDetailSet",template:T,filters:f,sorter:s,groupHeaderFactory:function(g){return new sap.m.GroupHeaderListItem({title:g.text,upperCase:false});}});}else{l.bindAggregation("items",{path:"/MilestoneDetailSet",template:T,sorter:s,groupHeaderFactory:function(g){return new sap.m.GroupHeaderListItem({title:g.text,upperCase:false});}});}this.registerMasterListBind(l);},groupByProject:function(c){return{key:c.getProperty('Project'),text:"Project  ["+c.getProperty('Project')+"]"};}});
